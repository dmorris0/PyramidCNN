## A Pyramid CNN for Dense-Leaves SegmentationCreated by Daniel Morris at Michigan State University### Introduction:<img src="https://www.egr.msu.edu/3dvision/Images/DenseLeaves.jpg" width="300"><img src="https://www.egr.msu.edu/3dvision/Images/DenseLeavesSegs.jpg" width="300">Automatic detection and segmentation of overlapping leaves in dense foliage can be a difficult task, particularly for leaves with strong textures and high occlusions.  We propose a pyramid convolutional neural network with multi-scale predictions that detects and discriminates leaf boundaries from interior textures.  Using these detected boundaries, closed-contour boundaries around individual leaves are estimated with a watershed-based algorithm.  The result is an instance segmenter for dense leaves.  Promising segmentation results for leaves in dense foliage are obtained and more details are available in the [paper](https://arxiv.org/abs/1804.01646).### CitationsIf you are using the code/model/data provided here in a publication, please cite our paper:    @INPROCEEDINGS{MorrisPCNN:2018,      author={Daniel D. Morris},      booktitle={2018 15th Conference on Computer and Robot Vision (CRV)},      title={A pyramid CNN for Dense-Leaves Segmentation},      pages={238-245},      doi={10.1109/CRV.2018.00041},      month={May},      year={2018},}### ChangelogThe initial release contains 2 pre-trained models plus code for running the CNN, doing instance segmentation, and for evaluating the results.  We anticipate releasing code for training in the near future.  ### Pretrained modelWe provide the pretrained model and training/testing ### Installing  0. Install and build MatConvNet: http://www.vlfeat.org/matconvnet/ 0. Clone PyramidCNN: https://github.com/dmorris0/PyramidCNN 0. Add the following folders from these repos to the Matlab path:   * `<PyramidCNN>/MatlabCode`  * `<MatConvNet>/matlab`  * `<MatConvNet>/matlab/mex`### Running NetworkIn Matlab:    >> cd <PyramidCNN>/Scripts    >> runLeafNetThis will download the DenseLeaves dataset from https://www.egr.msu.edu/denseleaves/, load and run the trained network on the test folder, perform instance segmentation, plot results during the process, and output evaluation.  ### EvaluationStatistics are output into file: AllStats.txt.  A table of results is shown below (corresponding to Table 1 of the paper).  Boundary AP indicates average precision in estimating segment boundary pixels.  Unlike the paper, boundary pixels at the edge of the image are included.  Also the model has been retrained and has slightly different values.<style type="text/css">.tg  {border-collapse:collapse;border-spacing:0;}.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}.tg .tg-us36{border-color:inherit;vertical-align:top}</style><table class="tg">  <tr>    <th class="tg-us36">Method</th>    <th class="tg-us36">Boundary AP</th>    <th class="tg-us36">Segmentation Dice</th>    <th class="tg-us36">Precision</th>    <th class="tg-us36">Recall</th>  </tr>  <tr>    <td class="tg-us36">Gradient Mag</td>    <td class="tg-us36">0.807</td>    <td class="tg-us36">NA</td>    <td class="tg-us36">NA</td>    <td class="tg-us36">NA</td>  </tr>  <tr>    <td class="tg-us36">Canny</td>    <td class="tg-us36">0.820</td>    <td class="tg-us36">NA</td>    <td class="tg-us36">NA</td>    <td class="tg-us36">NA</td>  </tr>  <tr>    <td class="tg-us36">PB</td>    <td class="tg-us36">0.863</td>    <td class="tg-us36">0.599</td>    <td class="tg-us36">0.511</td>    <td class="tg-us36">0.724</td>  </tr>  <tr>    <td class="tg-us36">HED</td>    <td class="tg-us36">0.849</td>    <td class="tg-us36">0.728</td>    <td class="tg-us36">0.668</td>    <td class="tg-us36">0.800</td>  </tr>  <tr>    <td class="tg-us36">PN-P1</td>    <td class="tg-us36">0.974</td>    <td class="tg-us36">0.890</td>    <td class="tg-us36">0.883</td>    <td class="tg-us36">0.897</td>  </tr>  <tr>    <td class="tg-us36">PN-P5-S5</td>    <td class="tg-us36">0.974</td>    <td class="tg-us36">0.929</td>    <td class="tg-us36">0.910</td>    <td class="tg-us36">0.950</td>  </tr>  <tr>    <td class="tg-us36">PN-P5-S1</td>    <td class="tg-us36">0.991</td>    <td class="tg-us36">0.938</td>    <td class="tg-us36">0.932</td>    <td class="tg-us36">0.944</td>  </tr></table>If something is not working please let me know.